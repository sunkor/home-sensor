const fs = require('fs');
const path = require('path');

function config(opts = {}) {
  const envPath = opts.path || path.resolve(process.cwd(), '.env');
  try {
    const data = fs.readFileSync(envPath, 'utf8');
    data.split(/\r?\n/).forEach(line => {
      const match = line.match(/^\s*([A-Za-z_][A-Za-z0-9_]*)\s*=\s*(.*)\s*$/);
      if (match) {
        let value = match[2];
        if ((value.startsWith('"') && value.endsWith('"')) || (value.startsWith("'") && value.endsWith("'"))) {
          value = value.slice(1, -1);
        }
        if (!Object.prototype.hasOwnProperty.call(process.env, match[1])) {
          process.env[match[1]] = value;
        }
      }
    });
    return { parsed: true };
  } catch (err) {
    return { error: err };
  }
}

module.exports = { config };
